@page
@model             EnableAuthenticatorModel
@{
    Layout = null;
    ViewData["Title"] = sharedLocalizer["Configure authenticator app"];
}
@using Microsoft.AspNetCore.Mvc.Localization;
@using OneBeyond.Studio.Obelisk.WebApi.Localizations;
@using OneBeyond.Studio.Obelisk.WebApi.Pages.Account.TFA;
@using OneBeyond.Studio.Obelisk.WebApi.Helpers;
@inject IHtmlLocalizer<SharedResources> sharedLocalizer;

<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta content="width=device-width,maximum-scale=1.0,initial-scale=1.0,minimum-scale=1.0,user-scalable=yes,shrink-to-fit=no" name="viewport">

    <title>@ViewData["Title"]</title>

    <link href="~/@UIBuildFileHelpers.GetFileNameFromUIBundle("mainCss.*.css")" rel="stylesheet" />
</head>

<body id="page-account">

    <div class="d-flex align-items-center justify-content-center row min-vh-100">
        <div class="account-box authenticator-box">

            <partial name="_StatusMessage" for="StatusMessage" />

            <h4>@ViewData["Title"]</h4>

            <div>
                <p>@sharedLocalizer["To use an authenticator app go through the following steps:"]</p>
                <ol class="list">
                    <li>
                        @sharedLocalizer["Download a two-factor authenticator app like Microsoft Authenticator for"]
                        <a href="https://go.microsoft.com/fwlink/?Linkid =825072">@sharedLocalizer["Android"]</a> @sharedLocalizer["and"]
                        <a href="https://go.microsoft.com/fwlink/?Linkid =825073">@sharedLocalizer["iOS"]</a> @sharedLocalizer["or"]
                        @sharedLocalizer["Google Authenticator for"]
                        <a href="https://play.google.com/store/apps/details?id =com.google.android.apps.authenticator2&amp;hl =en">@sharedLocalizer["Android"]</a> @sharedLocalizer["and"]
                        <a href="https://itunes.apple.com/us/app/google-authenticator/id388497605?mt =8">@sharedLocalizer["iOS"]</a>.

                    </li>
                    <li>
                        @sharedLocalizer["Scan the QR Code or enter this key"] <kbd>@Model.SharedKey]</kbd> @sharedLocalizer["into your two factor authenticator app. Spaces and casing do not matter."]
                        <div id="qrCode"></div>
                        <div id="qrCodeData" data-url="@Html.Raw(@Model.AuthenticatorUri)"></div>
                    </li>
                    <li>

                        @sharedLocalizer["Once you have scanned the QR code or input the key above, your two factor authentication app will provide you " +
                        "with a unique code.Enter the code in the confirmation box below."]

                        <div class="row">
                            <div class="col-md-6">
                                <form id="send-code" method="post">
                                    <div class="form-group">
                                        <label asp-for="Input.Code" class="control-label">@sharedLocalizer["Verification Code"]</label>
                                        <input asp-for="Input.Code" class="form-control" autocomplete="off" />
                                        <span asp-validation-for="Input.Code" class="text-danger"></span>
                                    </div>
                                    <button type="submit" class="btn btn-primary">@sharedLocalizer["Verify"]</button>
                                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                </form>
                            </div>
                            <div style="clear:both;"></div>
                        </div>
                    </li>
                </ol>
            </div>
        </div>
    </div>

    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script type="text/javascript" src="~/js/qrcode/qrcode.min.js"></script>

    <script type="text/javascript">
            new QRCode(document.getElementById("qrCode"),
                {
                    text: "@Html.Raw(Model.AuthenticatorUri)",
                    width: 200,
                    height: 200
                });
    </script>

    <partial name="_PageFooter" />

</body>

</html>
